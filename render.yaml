# Файл конфигурации "инфраструктура как код" для Render.
# Он автоматически создает все необходимые сервисы.

services:
  # 1. База данных PostgreSQL для хранения результатов
  - type: psql # ИСПРАВЛЕНО: pserv -> psql
    name: coin-sifter-db
    # Используем PostgreSQL
    databaseName: coinsifterdb
    user: coinsifter_user
    plan: free # Можно поменять на 'starter' для более мощной базы
    region: frankfurt # Вы можете выбрать другой регион
    ipAllowList: [] # Доступ открыт для сервисов Render

  # 2. Cron Job (периодическая задача) для запуска скрипта
  - type: cron
    name: coin-sifter-job
    plan: free
    region: frankfurt
    # Указываем, что это Python-проект
    env: python
    # Команда для установки зависимостей перед каждым запуском
    buildCommand: "pip install -r requirements.txt"
    # Основная команда для запуска вашего скрипта
    startCommand: "python main.py"
    # Расписание запуска. "0 2 1 * *" означает "в 02:00 ночи 1-го числа каждого месяца"
    # Формат: Минута Час День Месяц День_недели
    schedule: "0 2 1 * *"
    # Переменные окружения для скрипта
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: coin-sifter-db
          property: internalConnectionString
      - key: PYTHON_VERSION
        value: 3.11.5 # Укажите версию Python, которую вы используете

